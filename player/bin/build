#!/usr/bin/env bash

cd "$(dirname $0)/../"

mkdir -p target

# Keep the target folder from getting too big by deleting any builds older than
# 7 days.
find target/ -type d -mtime +7 -exec rm -vrf {} \;

build_sha="$(../bin/current-content-sha player)"

if [[ -d "target/$build_sha" ]]; then
  echo "Existing build: $PWD/target/$build_sha"
  exit 0
fi

./gradlew build

echo
tree build/libs/

# TODO:
# * Create the non-Windows build by prepending the shebang header (see
#   boot-jar2bin for example)
# * Create the Windows build using launch4j.
# * Artifacts should go in target/$build_sha/

